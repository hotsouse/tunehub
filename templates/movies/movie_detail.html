{% extends "base.html" %}

{% block title %}{{ movie.title }} · Catalog{% endblock %}

{% block content %}
<div class="page-header">
  <h1>{{ movie.title }}</h1>
  <div>
    <a href="/movies/" class="btn btn-secondary">Все фильмы</a>
    {% if request.user.is_authenticated %}
      <form method="post" action="/movies/{{ movie.id }}/favorite/" style="display:inline-block;">
        {% csrf_token %}
        <button class="btn btn-favorite" type="submit">{% if is_favorited %}Убрать из избранного{% else %}В избранное{% endif %}</button>
      </form>
    {% endif %}
  </div>
  <div class="card-badges">
    <span class="year">{{ movie.release_year }}</span>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <p><strong>Жанры:</strong> {{ movie.genres.all|join:", " }}</p>
    <p><strong>Режиссёры:</strong> {{ movie.directors.all|join:", " }}</p>
    <p><strong>Актёры:</strong> {{ movie.actors.all|join:", " }}</p>
    <p class="description">{{ movie.description }}</p>
    <p><strong>Рейтинг:</strong> {{ movie.rating|floatformat:1 }}</p>
  </div>
</div>

<div class="mt-4">
  <h3>Отзывы</h3>
  {% if reviews %}
    <ul class="list-group">
      {% for r in reviews %}
        <li class="list-group-item">
          <strong>{{ r.user.username }}</strong> · {{ r.created_at|date:"Y-m-d H:i" }} · Оценка: {{ r.rating }}
          <div>{{ r.comment|default:"Без комментария" }}</div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="empty">Пока нет отзывов</div>
  {% endif %}
</div>

{% if request.user.is_authenticated %}
  <div class="form-container mt-4">
    <h3>Оставить отзыв</h3>
    <form method="post" class="form">
      {% csrf_token %}
      {{ form.as_p }}
      <div class="form-actions">
        <button type="submit" class="btn btn-primary btn-large">Отправить</button>
      </div>
    </form>
  </div>
{% else %}
  <p class="mt-3">Чтобы оставить отзыв, <a href="/accounts/login/">войдите</a>.</p>
{% endif %}
{% endblock %}


