{% extends 'base.html' %}
{% block title %}Albums ¬∑ Catalog{% endblock %}
{% block content %}
<div class="page-header">
  <h1>üíø –ê–ª—å–±–æ–º—ã</h1>
  <div>
    {% if request.user.is_staff %}
      <a href="/admin/music/album/add/" class="btn btn-edit">–î–æ–±–∞–≤–∏—Ç—å –∞–ª—å–±–æ–º</a>
    {% endif %}
    <a href="/music/tracks/" class="btn btn-secondary">–¢—Ä–µ–∫–∏</a>
  </div>
  <a href="/music/" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
</div>

<div class="search-sort-container">
  <form method="get" class="search-form" style="flex:1">
    <input type="text" name="q" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞—Ä—Ç–∏—Å—Ç—É..." value="{{ search_query }}" />
    <select name="genre" class="search-input" style="max-width:220px">
      <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
      {% for g in genres %}
      <option value="{{ g.name }}" {% if request.GET.genre == g.name %}selected{% endif %}>{{ g.name }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
  </form>
</div>

{% if page_obj %}
  <div class="grid">
    {% for a in page_obj %}
      <div class="card">
        <div class="card-header">
          <h3>{{ a.title }}</h3>
          <div class="card-badges">
            <span class="year">{{ a.release_year }}</span>
          </div>
        </div>
        <div class="card-body">
          <p><strong>–ê—Ä—Ç–∏—Å—Ç:</strong> {{ a.artist.name }}</p>
          <p><strong>–ñ–∞–Ω—Ä—ã:</strong> {{ a.genres.all|join:', ' }}</p>
        </div>
        <div class="card-actions">
          <a href="/music/albums/{{ a.id }}/" class="btn btn-secondary">–û—Ç–∫—Ä—ã—Ç—å</a>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="empty-state">
    <h3>–ù–µ—Ç –∞–ª—å–±–æ–º–æ–≤</h3>
  </div>
{% endif %}

<nav class="mt-3 d-flex gap-2 flex-wrap align-items-center">
  {% with sq=search_query gf=request.GET.genre %}
    {% if page_obj.has_previous %}
      <a class="btn btn-outline-secondary btn-sm" href="?q={{ sq }}&genre={{ gf }}&page=1">First</a>
      <a class="btn btn-outline-secondary btn-sm" href="?q={{ sq }}&genre={{ gf }}&page={{ page_obj.previous_page_number }}">Prev</a>
    {% endif %}
    <span class="text-muted small">–°—Ç—Ä. {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a class="btn btn-outline-secondary btn-sm" href="?q={{ sq }}&genre={{ gf }}&page={{ page_obj.next_page_number }}">Next</a>
      <a class="btn btn-outline-secondary btn-sm" href="?q={{ sq }}&genre={{ gf }}&page={{ page_obj.paginator.num_pages }}">Last</a>
    {% endif %}
  {% endwith %}
</nav>
{% endblock %}

